PRD (產品需求文件) 
專案名稱: 台灣股市三大法人籌碼爬蟲工具

文件版本: 1.1

1. 專案目標
開發一個自動化的 Python 應用程式，用於高效、可靠地獲取台灣上市(TWSE)與上櫃(TPEx)市場每日三大法人的交易資料，並將其結構化地存儲，以利於後續的資料分析與策略回測。

2. 功能需求 (Functional Requirements)

ID	需求描述	備註
FR-1	資料來源：程式需能從台灣證券交易所(TWSE)和證券櫃檯買賣中心(TPEx)的後端API獲取CSV資料。	
FR-1.1	TWSE (上市) 資料來源: 需存取以下三個API端點： - 外資: https://www.twse.com.tw/rwd/zh/fund/TWT38U - 投信: https://www.twse.com.tw/rwd/zh/fund/TWT44U - 自營商: https://www.twse.com.tw/rwd/zh/fund/TWT43U	查詢參數需動態組合：date=YYYYMMDD (西元年) 和 response=csv。
FR-1.2	TPEx (上櫃) 資料來源: 需存取以下API端點： - 三大法人: https://www.tpex.org.tw/web/stock/3insti/daily_trade/3itrade_hedge_result.php	查詢參數需動態組合：d=YYY/MM/DD (民國年) 和 o=csv。
FR-2	資料範圍：需抓取三大法人（外資、投信、自營商）的每日買賣超資料。	
FR-3	輸入設定：程式需能讀取一個名為 stock_list.csv 的檔案，以決定要追蹤的股票清單與其所屬市場（上市/上櫃）。	程式需能自動尋找包含 stock_code 和 上市上櫃 的標頭行。
FR-4	執行模式：支援兩種執行模式： 1. 預設模式：抓取當日資料。 2. 歷史模式：透過 --days N 指令列參數，抓取過去N天的資料。	
FR-5	增量更新：再次執行時，程式需能自動檢測已存在的每日檔案，並跳過下載，只抓取遺漏的日期。	避免重複下載，提高效率。
FR-6	TWSE資料處理： FR-6.1 (外資): 只擷取「外資及陸資」總計欄位，並加上外資_前綴。 FR-6.2 (投信): 擷取所有欄位，並加上投信_前綴。 FR-6.3 (自營商): 只擷取「自行買賣」和「避險」細項，不需總計。	這是最核心的資料清理與篩選規則。
FR-7	TPEx資料處理： FR-7.1 (欄位統一): 將代號、名稱統一為證券代號、證券名稱。 FR-7.2 (欄位篩選): 套用與TWSE完全相同的篩選規則（外資取總計，自營商取細項）。 FR-7.3 (欄位命名): 直接沿用TPEx原始的描述性欄位名，不額外加前綴。	確保最終輸出格式的統一性。
FR-8	資料輸出： FR-8.1 (目錄結構): 需根據市場別，將資料分別存入 data/twse_raw 和 data/tpex_raw。 FR-8.2 (每日檔案): 每個追蹤的股票，每日產生一個獨立的CSV檔。 FR-8.3 (累加檔案): 每個追蹤的股票，維護一個包含所有歷史資料的總表。	實現清晰、有條理的資料倉儲。
FR-9	錯誤處理： FR-9.1 (SSL問題): 需能自動處理網站的SSL憑證驗證問題。 FR-9.2 (無資料日): 當某日為假日或無交易資料時，程式不應崩潰，應能正常跳過。	提升程式的穩健性。

匯出到試算表
3. 非功能需求 (Non-functional Requirements)

ID	需求描述
NFR-1	效能: 程式需使用多執行緒技術，以加速多日資料的並行下載。
NFR-2	可靠性: 程式在遇到網路錯誤或特定日期資料格式錯誤時，不應中斷整體任務。
NFR-3	易用性: 透過簡單的指令列介面即可操作。

匯出到試算表
4. 假設與限制 (Assumptions & Constraints)

專案的正確運行，依賴於TWSE與TPEx網站的URL結構與回傳資料格式的穩定性。若上游網站進行大幅度改版，本程式可能需要對應修改。

程式的執行效能受限於本地網路速度以及目標網站的伺服器回應速度。